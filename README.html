<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tin</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><h1 id="tin">TIN</h1>



<h2 id="spis-treści">Spis treści:</h2>

<p><div class="toc">
<ul>
<li><a href="#tin">TIN</a><ul>
<li><a href="#spis-treści">Spis treści:</a></li>
<li><a href="#podział-na-moduły">Podział na moduły</a><ul>
<li><ul>
<li><a href="#moduł-1-kontakt-poprzez-protokół-http-za-pomocą-jsonów">Moduł 1: Kontakt poprzez protokół HTTP za pomocą JSON’ów:</a></li>
<li><a href="#moduł-2-tracer">Moduł 2: Tracer:</a></li>
<li><a href="#moduł-3-centrum-kontroli-danych">Moduł 3: Centrum kontroli danych:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#struktury-danych">Struktury danych</a><ul>
<li><ul>
<li><a href="#json">JSON:</a></li>
<li><a href="#obiekty">Obiekty:</a></li>
<li><a href="#sqlitetabele-zmianiamy-na-jakis-plik-tekstowy-skoro-nie-mamy-tego-ładnie-parsowac">SQLite(tabele): ??? zmianiamy na jakis plik tekstowy skoro nie mamy tego ładnie parsowac ???</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#szczegółowy-opis-działania-modułów">Szczegółowy opis działania modułów</a><ul>
<li><a href="#moduł-1">Moduł 1</a><ul>
<li><a href="#dotraceroute">/doTraceroute</a></li>
<li><a href="#getdata">/getData</a></li>
</ul>
</li>
<li><a href="#moduł-2">Moduł 2</a></li>
<li><a href="#moduł-3">Moduł 3</a><ul>
<li><a href="#interakcja-z-modułem-1">Interakcja z modułem 1:</a></li>
<li><a href="#interakcja-z-modułem-2">Interakcja z modułem 2:</a></li>
<li><a href="#interakcja-z-bazą-danych">Interakcja z bazą danych:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</p>

<p>Celem zadania jest implementacja serwera umożliwiającego współbieżne wykonywanie wielu mapowań połączeń pomiędzy ruterami. Zachowanie pojedynczego sprawdzenia trasy zgodne jest z działaniem programu tracert ze środowiska MS Windows - program wysyła komunikaty ICMP ECHO_REQUEST z kolejnymi wartościami pola TTL i oczekuje komunikatów ICMP TIME_EXCEEDED. Zlecenie wykonania zadania oraz odbiór wyników wykorzystuje połączenie z wykorzystaniem protokołu HTTP i notacji/składni JSON.</p>



<h2 id="podział-na-moduły">Podział na moduły</h2>



<h4 id="moduł-1-kontakt-poprzez-protokół-http-za-pomocą-jsonów">Moduł 1: Kontakt poprzez protokół HTTP za pomocą JSON’ów:</h4>

<p>Odbiera prośby z poza serwera oraz zwraca dane.</p>



<h4 id="moduł-2-tracer">Moduł 2: Tracer:</h4>

<p>Na podstawie żądań <b>Modułu 3</b> wykonuj tracerouta (TODO: lepiej to ubrać w słowa)</p>



<h4 id="moduł-3-centrum-kontroli-danych">Moduł 3: Centrum kontroli danych:</h4>

<p>Obsługuje dwie kolejki żądań: od <b> modułu 1</b> i <b> modułu 2</b>(może również żądać wykonywania zadań). Na ich podstawie dokonuje parsowania danych do formy rozumianej przez konkretne moduły i przesyłania ich do bazy lub wyciągania z bazy w celu dalszej obróbki i zwrócenia żądanych danych.</p>



<h2 id="struktury-danych">Struktury danych</h2>



<h4 id="json">JSON:</h4>

<p>Żądanie wykonania tracerouta:</p>



<pre class="prettyprint"><code class=" hljs r">{
    addresses: [
        {
            address: ip
        },
        {<span class="hljs-keyword">...</span>}]`
}</code></pre>

<p>Zwrotka z numerem zadania:</p>



<pre class="prettyprint"><code class=" hljs css"><span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">task</span>:<span class="hljs-value"> nr
</span></span></span>}</code></pre>

<p>Zapytanie o dane z numeru zadania:</p>



<pre class="prettyprint"><code class=" hljs r">{
    tasks:[
        {
            task: nr
        },
        {<span class="hljs-keyword">...</span>}]
}</code></pre>

<p>Dane z zadania:</p>



<pre class="prettyprint"><code class=" hljs r">{
    tasks:[
    {
    task: nr,
    addresses:[
        {
            address: ip,
        },
        {<span class="hljs-keyword">...</span>}]
    },
    {<span class="hljs-keyword">...</span>}
    ]
}</code></pre>



<h4 id="obiekty">Obiekty:</h4>

<p>Zadanie:</p>



<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>:</span>
    ip[]
    task_number</code></pre>

<p>Wynik zadania(z Modułu 2):</p>



<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskResult</span>:</span>
    task_number
    addresses[traceroute[]] /<span class="hljs-regexp">/tablica tablic (wiele adresow ip)</span></code></pre>

<p>Adresy:</p>



<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Addresses</span>:</span>
    <span class="hljs-symbol">taks:</span> nr
    addresses[traceroute[]] /<span class="hljs-regexp">/tablica tablic (wiele adresow ip)</span></code></pre>

<p>Sparsowane dane:</p>



<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParsedData</span>:</span>
    <span class="hljs-constant">Addresses</span>[]</code></pre>



<h4 id="sqlitetabele-zmianiamy-na-jakis-plik-tekstowy-skoro-nie-mamy-tego-ładnie-parsowac">SQLite(tabele): ??? zmianiamy na jakis plik tekstowy skoro nie mamy tego ładnie parsowac ???</h4>

<p>Zadania:</p>



<pre class="prettyprint"><code class=" hljs http"><span class="hljs-attribute">TASK_NUMBER</span>: <span class="hljs-string">numer zadania (pk)</span>
<span class="hljs-attribute">START_DATE</span>: <span class="hljs-string">czas rozpoczęcia zadania (notnull)</span>
<span class="hljs-attribute">END_DATE</span>: <span class="hljs-string">czas zakończenia zadania</span></code></pre>

<p>Pojedynczy wynik tracerouta:</p>



<pre class="prettyprint"><code class=" hljs http"><span class="hljs-attribute">TASK_NUMBER</span>: <span class="hljs-string">numer zadania (pk)</span>
<span class="hljs-attribute">IP</span>: <span class="hljs-string">adres ip (pk)</span></code></pre>

<p>Relacja</p>



<pre class="prettyprint"><code class=" hljs http"><span class="hljs-attribute">PRE_IP</span>: <span class="hljs-string">numer poprzedniego (pk, fk)</span>
<span class="hljs-attribute">NEXT_IP</span>: <span class="hljs-string">numer nastepnego (pk, fk)</span></code></pre>



<h2 id="szczegółowy-opis-działania-modułów">Szczegółowy opis działania modułów</h2>



<h3 id="moduł-1">Moduł 1</h3>

<p>Moduł 1 odbiera JSON’y przesyłane od kilenta za pomocą protokołu HTTP(POST). Następnie w zależności od danego żądania będzie wykonywał jedno z dwóch zadań.</p>



<h4 id="dotraceroute">/doTraceroute</h4>

<p>Moduł odbiera JSON’a z danymi do tracerouta (struktura powyżej) przekształca go do obiektu, nadaje unikalny numer zadania (który zwraca również w postaci JSON’a) a następnie umieszcza obiekt w kolejce oczekujących,</p>



<h4 id="getdata">/getData</h4>

<p>Moduł odbiera JSON’a z numerem zadania. Składa żądanie do modułu 3 o dane o zadanym numerze. Jeśli w zwrocie dostaje dane to parsuje je do JSON’a którego zwraca, jeśli nie zwraca odpowiedni kod błędu</p>

<p>Moduł 1 działa na “jednym” samoklonującym się wątku który w sytuacji odebrania żądania tworzy swojego kolna a sam zajmuje się wykonaniem zadanego zadania.</p>



<h3 id="moduł-2">Moduł 2</h3>

<p>Moduł nr 2 wykonuje operację trasowania pakietów. Wykorzystuje protokół ICMP - internetowy protokół komunikatów kontrolnych. Moduł wysyła komunikaty ICMP ECHO_REQUEST (znane np. z programu ping) z kolejnymi wartościami pola TTL i oczekuje komunikatów TIME_EXCEEDED (przekroczony TTL) oraz ECHO_REPLY (pakiet dotarł do celu, koniec trasy). Moduł podzielony jest na trzy zasadnicze elementy - generator pakietów, wątki wywysłające pakiety oraz wątek odbierający pakiety i rozdzielający odebrane dane według odpowiednich pól nagłówka odebranego komunikatu. Generator pakietów generuje pakiety o określoym TTL (Time-To-Live) i określonych wartościach pól Sequence i Identifier. Identifier to całkowitoliczbowy identyfikator konkretnej śledzonej trasy (czyli też wątku wysyłającego), a Sequence to TTL pakietu. Dzięki możliwości identyfikacji pakietów należących do poszczególnych tras i o konkretnych TTL, aplikacja może śledzić wiele ścieżek na raz.</p>

<p>Moduł do łączenia się ze światem zewnętrznym wykorzystuje tzw. “raw sockets”, czyli gniazda umożliwiające wysyłkę i odbiór pakietów IP bez informacji warstwy transportu.</p>

<p>Maksymalny TTL, liczba pakietów bez informacji zwrotnej i oczekiwanie na odpowiedź to parametry konfiguracyjne, które mogą być określone w pliku XML i otagowane identyfikatorami ttl (1-255), attempts oraz timeout.</p>

<p>Algorytm trasowania:</p>

<ol>
<li><p>Przyjmij od modułu nr 3 (kolejka) dane określające, jaka trasa ma być wyznaczona.</p></li>
<li><p>Uruchom wątek wysyłający pakiety. Wątek ma przydzielony “identyfikator trasy”, który zostanie wykorzystany jako pole Identifier w nagłówku ICMP.</p></li>
<li><p>n = 1.</p></li>
<li><p>Wygeneruj za pomocą generatora pakiet o TTL = n, Identifier = identyfikator trasy, Sequence = n, wyślij go i poinformuj wątek odbierający o konieczności rozpoczęcia odmierzania czasu przeznaczonego na odbiór pakietu. Po tym czasie wątek odbierający poinformuje wątek wysyłający, że może spróbować jeszcze raz (ale maksymalnie tyle razy, ile wynosi parametr Attempts).</p></li>
<li><p>Czekaj na informację zwrotną od wątku odbierającego zawierającą adres IP routera pośredniczącego i kod odpowiedzi. Zinterpretuj informację - być może należy zakończyć trasowanie. Jeśli nie, dodaj adres do trasy. n += 1 i wróć do punktu 3.</p></li>
<li><p>Po zakończeniu trasowania wątek wysyłający przesyła do Modułu nr 3 wyznaczoną trasę lub jej fragment/kod błędu (struktura składająca się z nagłówka oraz listy adresów).</p></li>
</ol>



<h3 id="moduł-3">Moduł 3</h3>

<p>Moduł trzy zarządza wszelkim ruchem na serwerze. Obsługuje i wysyła żądania do wszystkich pozostałych modułów.</p>



<h4 id="interakcja-z-modułem-1">Interakcja z modułem 1:</h4>

<ol>
<li>Odbiór danych do tracerouta</li>
<li>Odbiór żądania danych wynikowych: <br>
a. Brak gotowych <br>
b. Sparsowanie danych i przesłanie do modułu 1</li>
</ol>



<h4 id="interakcja-z-modułem-2">Interakcja z modułem 2:</h4>

<ol>
<li>Wrzucenie do kolejki danych do tracerouta</li>
<li>Odbiór z kolejki danych z tracerouta i sparsowanie ich.</li>
</ol>



<h4 id="interakcja-z-bazą-danych">Interakcja z bazą danych:</h4>

<ol>
<li>Dodanie nowego zadania</li>
<li>Dodanie danych z zadania - zakończenie zadania</li>
<li>Wyciągnięcie informacji o stanie zadania: <br>
a. Nieskończone <br>
b. Gotowe - parsowanie danych.</li>
</ol>

<p>Moduł będzie działał na dwóch wątkach. <br>
Pierwszy będzie cyklicznie sprawdzał czy w kolejkach nie ma zadań do wykonania a następnie w zależności od sytuacji wykonywał odpowiednie zadania takie jak parsowanie, zapisywanie do bazy, przesyłanie danych między kolejkami. <br>
Drugi będzie przeznaczony tylko i wyłącznie do sytuacji związanych z żądaniami wyników jako, że takie działania mają priorytet (klient oczekuję na reakcję serwera). Będzie on sprawdzał gotowość zadania i w zależności od sytuacji zwracał informację o tym że zadanie jeszcze nie skończone lub parsował dane z bazy do wersji obiektowej i przesyłał z powrotem do modułu 1.</p>

<blockquote>
  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote></div></body>
</html>